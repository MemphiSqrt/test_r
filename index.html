<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤œåŸåè®®: æºä»£ç </title>
    <style>
        :root {
            --bg-color: #050505;
            --terminal-green: #0f0;
            --terminal-dim: #004400;
            --alert-red: #ff3333;
            --ui-border: 2px solid #333;
        }
        body {
            background-color: var(--bg-color);
            color: var(--terminal-green);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            height: 100vh;
            box-sizing: border-box;
            overflow: hidden;
        }
        #game-container {
            width: 800px;
            height: 90%;
            display: flex;
            flex-direction: column;
            border: var(--ui-border);
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.1);
            background: #000;
            position: relative;
        }
        /* æ‰«æçº¿æ•ˆæœ */
        #game-container::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* é¡¶éƒ¨çŠ¶æ€æ  */
        #status-bar {
            padding: 10px;
            border-bottom: var(--ui-border);
            display: flex;
            justify-content: space-between;
            font-weight: bold;
        }

        /* ä¸»è¦æ–‡æœ¬åŒºåŸŸ */
        #log-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            font-size: 16px;
            line-height: 1.6;
        }
        .story-text {
            margin-bottom: 20px;
            animation: fadeIn 0.5s ease;
        }
        .system-msg {
            color: #888;
            font-style: italic;
            font-size: 0.9em;
            margin-bottom: 10px;
            border-left: 2px solid #555;
            padding-left: 10px;
        }

        /* é€‰é¡¹åŒºåŸŸ */
        #choices-area {
            padding: 20px;
            border-top: var(--ui-border);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* å¼€å‘è€…å·¥å…·åŒºåŸŸ */
        #dev-tools {
            padding: 5px;
            border-top: 1px dashed #333;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background: #0a0a0a;
        }
        .dev-btn {
            font-size: 12px;
            padding: 5px 10px;
            border: 1px solid #555;
            color: #888;
        }
        .dev-btn:hover {
            border-color: var(--terminal-green);
            color: var(--terminal-green);
        }

        button {
            background: transparent;
            border: 1px solid var(--terminal-green);
            color: var(--terminal-green);
            padding: 12px;
            text-align: left;
            cursor: pointer;
            font-family: inherit;
            font-size: 16px;
            transition: all 0.2s;
        }
        button:hover {
            background: var(--terminal-green);
            color: black;
        }
        button:disabled {
            border-color: #555;
            color: #555;
            cursor: not-allowed;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #004400; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="status-bar">
            <span>HP: <span id="hp-val">100</span>%</span>
            <span>CREDITS: <span id="credits-val">50</span></span>
            <span>LOCATION: <span id="loc-val">æœªçŸ¥</span></span>
        </div>
        
        <div id="log-area" id="scroll-target">
            <!-- å‰§æƒ…æ–‡æœ¬ä¼šåŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
        </div>

        <div id="choices-area">
            <!-- æŒ‰é’®ä¼šåŠ¨æ€æ’å…¥åˆ°è¿™é‡Œ -->
        </div>

        <div id="dev-tools">
            <button class="dev-btn" onclick="exportScript()">ğŸ› ï¸ å¯¼å‡ºå‰§æœ¬ (JSON)</button>
            <button class="dev-btn" onclick="resetGame(); showNode('start');">ğŸ”„ é‡ç½®æ¸¸æˆ</button>
        </div>
    </div>

    <script>
        // ==========================================
        // ç¬¬ä¸€éƒ¨åˆ†ï¼šæ¸¸æˆçŠ¶æ€ (State)
        // ==========================================
        const gameState = {
            hp: 100,
            credits: 50,
            inventory: [], // ä¾‹å¦‚ ['access_card', 'weapon']
            flags: {}      // è®°å½•åšå‡ºçš„å†³å®šï¼Œä¾‹å¦‚ { met_hacker: true }
        };

        // ==========================================
        // ç¬¬äºŒéƒ¨åˆ†ï¼šå‰§æƒ…æ•°æ® (Data)
        // è¿™é‡Œå¯ä»¥æœ‰å‡ åƒè¡Œï¼Œç”šè‡³ä»å¤–éƒ¨ JSON æ–‡ä»¶åŠ è½½
        // ç»“æ„ï¼šKey (èŠ‚ç‚¹ID) -> Value (æè¿°, é€‰é¡¹)
        // ==========================================
        const storyNodes = {
            "start": {
                text: "é›¨æ°´æ‹æ‰“åœ¨'è€ç»´å…‹'ä¹‰ä½“è¯Šæ‰€çš„éœ“è™¹ç¯ç‰Œä¸Šã€‚ä½ æ‘¸äº†æ‘¸åé¢ˆåˆšæ¤å…¥çš„èŠ¯ç‰‡ï¼Œé‚£é‡Œè¿˜åœ¨éšéšä½œç—›ã€‚\n\nä½ è¦æ‰¾çš„é»‘å®¢'å¹»å½±'å°±åœ¨é‡Œé¢ï¼Œä½†ä»–æ¬ äº†å¸®æ´¾ä¸€ç¬”é’±ã€‚",
                location: "ç¬¬7åŒº - è´«æ°‘çªŸ",
                choices: [
                    { text: "ç›´æ¥è¸¢é—¨è¿›å»", next: "kick_door", cost: 0 },
                    { text: "è§‚å¯Ÿå‘¨å›´ç¯å¢ƒ", next: "observe", cost: 0 },
                    { text: "åœ¨è‡ªåŠ¨å”®è´§æœºä¹°æ¯åˆæˆå’–å•¡ (10 Credits)", next: "buy_coffee", cost: 10, reqCredits: 10 }
                ]
            },
            "buy_coffee": {
                text: "æ¸©çƒ­çš„åŠ£è´¨æ¶²ä½“æ»‘è¿‡å–‰å’™ï¼Œå³ä½¿å…¨æ˜¯æ·»åŠ å‰‚çš„å‘³é“ï¼Œä¹Ÿè®©ä½ ç²¾ç¥äº†ä¸€äº›ã€‚\n(HP + 10)",
                effect: "heal_10", // æ”¹ä¸ºå­—ç¬¦ä¸²æ ‡è¯†ç¬¦ï¼Œæ–¹ä¾¿ JSON åºåˆ—åŒ–
                choices: [
                    { text: "å¥½äº†ï¼Œå¹²æ­£äº‹ã€‚è¿›è¯Šæ‰€ã€‚", next: "start" }
                ]
            },
            "observe": {
                text: "ä½ ç»•åˆ°è¯Šæ‰€ä¾§é¢ï¼Œå‘ç°æ’æ°”æ‰‡åäº†ï¼Œéœ²å‡ºäº†ä¸€ä¸ªåªèƒ½å®¹çº³ä¸€äººé€šè¿‡çš„æ´å£ã€‚é€šè¿‡è¿™é‡Œå¯ä»¥ç»•è¿‡å‰å°çš„ä¿é•–ã€‚",
                location: "è¯Šæ‰€ - åå··",
                choices: [
                    { text: "ä»æ’æ°”å£æ½œå…¥", next: "stealth_entry" },
                    { text: "è¿˜æ˜¯èµ°æ­£é—¨å§", next: "start" }
                ]
            },
            "kick_door": {
                text: "ä½ ä¸€è„šè¸¹å¼€å¤§é—¨ã€‚é‡Œé¢çš„ä¸¤ä¸ª'æ¼©æ¶¡å¸®'æ··æ··ç«‹åˆ»æ‹”å‡ºäº†çƒ­èƒ½åˆ€ã€‚\n\nâ€œæ‰¾æ­»å—ï¼Œå°å­ï¼Ÿâ€",
                location: "è¯Šæ‰€ - å¤§å ‚",
                choices: [
                    { text: "æ‹”æªå°„å‡» (éœ€è¦æ­¦å™¨)", next: "shoot", reqItem: "weapon" },
                    { text: "è¯•å›¾è°ˆåˆ¤", next: "negotiate" },
                    { text: "è½¬èº«é€ƒè·‘", next: "run_away" }
                ]
            },
            "stealth_entry": {
                text: "ä½ åƒè€é¼ ä¸€æ ·é’»è¿›ç®¡é“ï¼Œç°å°˜å‘›å¾—ä½ éš¾å—ã€‚ä½ é€è¿‡æ ¼æ …çœ‹åˆ°äº†'å¹»å½±'ï¼Œä»–æ­£è¢«ç»‘åœ¨æ‰‹æœ¯æ¤…ä¸Šï¼Œå¹¶æ²¡æœ‰ä¿é•–çœ‹å®ˆä»–ã€‚è¿™æ˜¯ä¸ªæœºä¼šã€‚",
                location: "è¯Šæ‰€ - æ‰‹æœ¯å®¤",
                choices: [
                    { text: "è·³ä¸‹å»æ•‘ä»–", next: "save_phantom" }
                ]
            },
            "negotiate": {
                text: "ä½ ä¸¾èµ·åŒæ‰‹ï¼šâ€œæˆ‘æ˜¯æ¥æ›¿ä»–è¿˜é’±çš„ã€‚â€\næ··æ··ä»¬å¯¹è§†äº†ä¸€çœ¼ï¼Œâ€œè¿æœ¬å¸¦åˆ©ï¼Œ200 Creditsã€‚ç°åœ¨å°±è¦ã€‚â€",
                choices: [
                    { text: "æ”¯ä»˜ 200 Credits", next: "pay_debt", reqCredits: 200 },
                    { text: "æˆ‘æ²¡é‚£ä¹ˆå¤šé’±... (HP -50)", next: "beat_up" }
                ]
            },
            "beat_up": {
                text: "è¿˜æ²¡ç­‰ä½ è§£é‡Šï¼Œä¸€è®°é‡æ‹³å°±æŠŠä½ æ‰“é£åˆ°äº†å¢™ä¸Šã€‚ä»–ä»¬æœèµ°äº†ä½ èº«ä¸Šæ‰€æœ‰çš„é’±ï¼ŒæŠŠä½ æ‰”åˆ°äº†å¤§è¡—ä¸Šã€‚",
                effect: "damage_50_lose_money",
                choices: [
                    { text: "è¯¥æ­»...é‡æ–°å¼€å§‹ã€‚", next: "start_reset" }
                ]
            },
            "save_phantom": {
                text: "ä½ å‰²æ–­äº†ç»³å­ã€‚'å¹»å½±'çœ‹ç€ä½ ï¼šâ€œè°¢äº†å…„å¼Ÿã€‚ä½œä¸ºå›æŠ¥ï¼Œè¿™ä¸ªç»™ä½ ã€‚â€\nä»–é€’ç»™ä½ ä¸€æŠŠæ”¹è£…è¿‡çš„ã€æ™ºèƒ½æ‰‹æªã€‘ã€‚",
                effect: "get_weapon",
                choices: [
                    { text: "æ”¶ä¸‹æ­¦å™¨ï¼Œç¦»å¼€è¿™é‡Œ", next: "mission_complete" }
                ]
            },
            "mission_complete": {
                text: "=== åºç« ç»“æŸ ===\n\nä½ æˆåŠŸæ¥è§¦äº†ç›®æ ‡å¹¶è·å¾—äº†æ­¦å™¨ã€‚ä½ åœ¨å¤œä¹‹åŸçš„ä¼ å¥‡æ‰åˆšåˆšå¼€å§‹ã€‚\n\n(æ­¤æ¼”ç¤ºåˆ°æ­¤ç»“æŸï¼Œè¿™å±•ç¤ºäº†é€»è¾‘ä¸æ•°æ®çš„åˆ†ç¦»)",
                location: "å¤œä¹‹åŸ - ä½ çš„å…¬å¯“",
                choices: [
                    { text: "é‡ç½®æ¸¸æˆ", next: "start_reset" }
                ]
            },
            "start_reset": {
                text: "æ­£åœ¨é‡ç½®ç³»ç»Ÿ...",
                effect: "reset_game",
                choices: [
                    { text: "ç³»ç»Ÿé‡å¯å®Œæˆ", next: "start" }
                ]
            },
            "run_away": {
                text: "ä½ è½è’è€Œé€ƒã€‚åœ¨å¤œä¹‹åŸï¼Œé€ƒè·‘å¹¶ä¸å¯è€»ï¼Œä½†æ¯«æ— æ”¶ç›Šã€‚",
                choices: [
                    { text: "è¿”å›èµ·ç‚¹", next: "start" }
                ]
            },
             "pay_debt": {
                text: "ä½ ä»˜äº†é’±ã€‚æ··æ··ä»¬è®©å¼€äº†è·¯ã€‚ä½†è¿™ç¬”é’±è®©ä½ è‚‰ç—›ä¸å·²ã€‚",
                effect: "pay_200",
                choices: [
                    { text: "å»æ‰¾å¹»å½±", next: "save_phantom" }
                ]
            }
        };

        // ==========================================
        // ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ¸¸æˆå¼•æ“ (Engine)
        // ==========================================
        
        const logArea = document.getElementById('log-area');
        const choicesArea = document.getElementById('choices-area');
        const hpEl = document.getElementById('hp-val');
        const creditEl = document.getElementById('credits-val');
        const locEl = document.getElementById('loc-val');

        // ä¸ºäº†æ–¹ä¾¿ JSON å¯¼å‡ºï¼Œæˆ‘ä»¬å°†æ•ˆæœé€»è¾‘å•ç‹¬æ˜ å°„
        // Unity ä¸­ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼ switch case æˆ– Command Pattern å¤„ç†è¿™äº›å­—ç¬¦ä¸²ID
        const effectHandlers = {
            "heal_10": () => updateHP(10),
            "damage_50_lose_money": () => { updateHP(-50); updateCredits(-gameState.credits); },
            "get_weapon": () => addItem("weapon"),
            "pay_200": () => updateCredits(-200),
            "reset_game": () => resetGame()
        };

        function updateHP(amount) {
            gameState.hp += amount;
            if(gameState.hp > 100) gameState.hp = 100;
            if(gameState.hp < 0) gameState.hp = 0;
            hpEl.innerText = gameState.hp;
            if(amount < 0) logSystem(`å—åˆ°ä¼¤å®³: ${amount} HP`);
            else if(amount > 0) logSystem(`æ¢å¤ç”Ÿå‘½: ${amount} HP`);
        }

        function updateCredits(amount) {
            gameState.credits += amount;
            creditEl.innerText = gameState.credits;
            if(amount < 0) logSystem(`å¤±å»ä¿¡ç”¨ç‚¹: ${Math.abs(amount)}`);
            else logSystem(`è·å¾—ä¿¡ç”¨ç‚¹: ${amount}`);
        }

        function addItem(item) {
            if(!gameState.inventory.includes(item)) {
                gameState.inventory.push(item);
                logSystem(`è·å¾—ç‰©å“: [${item}]`);
            }
        }

        function logSystem(msg) {
            const div = document.createElement('div');
            div.className = 'system-msg';
            div.innerText = msg;
            logArea.appendChild(div);
            scrollToBottom();
        }

        function scrollToBottom() {
            logArea.scrollTop = logArea.scrollHeight;
        }

        function resetGame() {
            gameState.hp = 100;
            gameState.credits = 50; 
            gameState.inventory = [];
            gameState.flags = {};
            hpEl.innerText = 100;
            creditEl.innerText = 50;
            logArea.innerHTML = '';
        }

        function showNode(nodeId) {
            const node = storyNodes[nodeId];
            if (!node) {
                console.error("Node not found:", nodeId);
                return;
            }

            // æ‰§è¡Œæ•ˆæœ (é€šè¿‡æŸ¥æ‰¾è¡¨)
            if (node.effect && effectHandlers[node.effect]) {
                effectHandlers[node.effect]();
            }

            if (node.location) {
                locEl.innerText = node.location;
            }

            const textDiv = document.createElement('div');
            textDiv.className = 'story-text';
            textDiv.innerText = node.text;
            logArea.appendChild(textDiv);
            scrollToBottom();

            choicesArea.innerHTML = '';
            
            node.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.innerText = choice.text;
                
                if (choice.reqCredits && gameState.credits < choice.reqCredits) {
                    btn.disabled = true;
                    btn.innerText += ` (éœ€è¦ ${choice.reqCredits} Credits)`;
                }
                
                if (choice.reqItem && !gameState.inventory.includes(choice.reqItem)) {
                    btn.disabled = true;
                    btn.innerText += ` (éœ€è¦ç‰©å“: ${choice.reqItem})`;
                }

                if (!btn.disabled) {
                    btn.onclick = () => {
                        if (choice.cost) updateCredits(-choice.cost);
                        showNode(choice.next);
                    };
                }

                choicesArea.appendChild(btn);
            });
        }

        // å¯¼å‡ºåŠŸèƒ½ï¼šå±•ç¤º JSON
        function exportScript() {
            const jsonString = JSON.stringify(storyNodes, null, 2);
            
            // ä¸ºäº†æ¼”ç¤ºï¼Œç›´æ¥æ˜¾ç¤ºåœ¨æ¸¸æˆæ—¥å¿—é‡Œ
            const div = document.createElement('div');
            div.style.border = "1px dashed #0f0";
            div.style.padding = "10px";
            div.style.margin = "10px 0";
            div.style.whiteSpace = "pre-wrap";
            div.style.fontSize = "12px";
            div.style.color = "#aaa";
            div.innerText = "=== Unity å¯¼å‡ºæ•°æ® (JSON) ===\nä½ å¯ä»¥ç›´æ¥å¤åˆ¶ä¸‹é¢çš„å†…å®¹ä¿å­˜ä¸º story.json\n\n" + jsonString;
            
            logArea.appendChild(div);
            scrollToBottom();
            
            alert("å‰§æœ¬æ•°æ®å·²ç”Ÿæˆåˆ°ä¸‹æ–¹æ—¥å¿—åŒºåŸŸï¼\nå°†æ¥åœ¨ Unity ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ JsonUtility.FromJson æ¥è¯»å–å®ƒã€‚");
        }

        // å¯åŠ¨æ¸¸æˆ
        resetGame();
        showNode('start');

    </script>
</body>
</html>
